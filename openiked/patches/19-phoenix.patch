diff -ruN a/CMakeLists.txt b/CMakeLists.txt
--- a/CMakeLists.txt	2021-08-23 16:27:21.921924735 +0200
+++ b/CMakeLists.txt	2021-08-18 17:36:16.314785137 +0200
@@ -59,9 +59,7 @@
 	endif()
 	add_definitions(-D_GNU_SOURCE)
 	add_definitions(-D_DEFAULT_SOURCE)
-	add_definitions(-DHAVE_UDPENCAP6)
 	add_definitions(-DSPT_TYPE=SPT_REUSEARGV)
-	set(HAVE_VROUTE_NETLINK ON)
 endif()
 if (NOT DEFINED CMAKE_INSTALL_MANDIR)
 	set (CMAKE_INSTALL_MANDIR ${CMAKE_INSTALL_PREFIX}/man)
@@ -77,6 +75,11 @@
 	add_definitions(-DHAVE_LINUX_PFKEY_H)
 endif()
 
+check_include_files("phoenix/pfkeyv2.h" HAVE_PHOENIX_PFKEY_H)
+if(HAVE_PHOENIX_PFKEY_H)
+	add_definitions(-DHAVE_PHOENIX_PFKEY_H)
+endif()
+
 if(CMAKE_BUILD_TYPE STREQUAL DEBUG)
 	message("Debug build.")
 elseif(CMAKE_BUILD_TYPE STREQUAL RELEASE)
@@ -118,6 +121,11 @@
 	add_definitions(-DHAVE_LINUX_IPSEC_H)
 endif()
 
+check_include_files("phoenix/ipsec.h" HAVE_PHOENIX_IPSEC_H)
+if(HAVE_PHOENIX_IPSEC_H)
+	add_definitions(-DHAVE_PHOENIX_IPSEC_H)
+endif()
+
 check_include_files("sys/types.h;sys/queue.h;imsg.h" HAVE_IMSG_H)
 if(HAVE_IMSG_H)
 	add_definitions(-DHAVE_IMSG_H)
diff -ruN a/compat/net/pfkeyv2.h b/compat/net/pfkeyv2.h
--- a/compat/net/pfkeyv2.h	2021-04-15 19:18:01.000000000 +0200
+++ b/compat/net/pfkeyv2.h	2021-08-09 08:49:35.423982344 +0200
@@ -18,4 +18,6 @@
 #include_next <net/pfkeyv2.h>
 #elif defined(HAVE_LINUX_PFKEY_H)
 #include <linux/pfkeyv2.h>
+#elif defined(HAVE_PHOENIX_PFKEY_H)
+#include <phoenix/pfkeyv2.h>
 #endif
diff -ruN a/compat/netinet/ip_ipsp.h b/compat/netinet/ip_ipsp.h
--- a/compat/netinet/ip_ipsp.h	2021-04-15 19:18:01.000000000 +0200
+++ b/compat/netinet/ip_ipsp.h	2021-08-09 08:49:35.423982344 +0200
@@ -26,12 +26,15 @@
 #ifdef HAVE_LINUX_IPSEC_H
 #include <linux/ipsec.h>
 #endif
+#ifdef HAVE_PHOENIX_IPSEC_H
+#include <phoenix/ipsec.h>
+#endif
 #ifdef HAVE_NETINET6_IPSEC_H
 #include <netinet6/ipsec.h>
 #endif
 
 #if !defined HAVE_IPSP_H && (defined HAVE_NET_IPSEC_H || \
-    defined HAVE_LINUX_IPSEC_H || defined HAVE_NETINET6_IPSEC_H)
+    defined HAVE_LINUX_IPSEC_H || defined HAVE_PHOENIX_IPSEC_H || defined HAVE_NETINET6_IPSEC_H)
 #if !defined(IPSP_DIRECTION_IN)
 #define IPSP_DIRECTION_IN	IPSEC_DIR_INBOUND
 #endif

